# GitHub Actions workflow that runs on a cron schedule.
name: Cron Scheduled CI Tests

on:
  workflow_dispatch:
  schedule:
    # run at 9am UTC on Mondays
    - cron: '0 9 * * 1'
  pull_request:
    # We also want this workflow triggered if the 'Extra CI' label is added
    # or present when PR is updated
    types:
      - synchronize
      - labeled

permissions:
  contents: read

jobs:
  # The linkcheck job tests that the links in the docs point to real places
  # The if statement is to prevent cron from running on forks.
  check:
    if: (github.repository == 'spacetelescope/jdaviz' && (github.event_name == 'schedule' || github.event_name == 'workflow_dispatch' || contains(github.event.pull_request.labels.*.name, 'Extra CI')))
    uses: OpenAstronomy/github-actions-workflows/.github/workflows/tox.yml@v1
    with:
      envs: |
        - linux: linkcheck

  tests:
    if: (github.repository == 'spacetelescope/jdaviz' && (github.event_name == 'schedule' || github.event_name == 'workflow_dispatch' || contains(github.event.pull_request.labels.*.name, 'Extra CI')))
    uses: OpenAstronomy/github-actions-workflows/.github/workflows/tox.yml@v1
    with:
      envs: |
        - linux: py310-test-romandeps
        - linux: py311-test-devdeps-romandeps
